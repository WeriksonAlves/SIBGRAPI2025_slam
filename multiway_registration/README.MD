# üìÑ **Documenta√ß√£o das Etapas Realizadas ‚Äî Dias 1 a 3**

### üóìÔ∏è Contexto: Cronograma de 2 Semanas para Reconstru√ß√£o Multi-Sensorial

Objetivo geral: comparar reconstru√ß√µes 3D a partir de sensores RGB-D e profundidade monocular usando o algoritmo de **multiway registration da Open3D**.

---

## ‚úÖ **üîπ Dia 1 ‚Äî Planejamento e Aquisi√ß√£o de Dados**

### üéØ Objetivo:

Realizar a aquisi√ß√£o de dados RGB-D utilizando a c√¢mera Intel RealSense D435 com ROS 2 e salvar os dados em formato `.bag`.

### üîß Procedimentos esperados:

* Conectar a D435 ao notebook.
* Lan√ßar o driver da c√¢mera com par√¢metros desejados:

  ```bash
  ros2 launch realsense2_camera rs_camera.launch.py \
      enable_depth:=true \
      enable_color:=true \
      align_depth.enable:=true \
      depth_module.profile:=640x480x10 \
      color_module.profile:=640x480x10
  ```
* Gravar dados com:

  ```bash
  ros2 bag record /camera/color/image_raw /camera/aligned_depth_to_color/image_raw /camera/color/camera_info -o datasets/lab_scene_01
  ```

### ‚ö†Ô∏è Problema enfrentado:

> Ap√≥s a execu√ß√£o, percebeu-se que os t√≥picos da c√¢mera **n√£o estavam ativos** e o `.bag` gravado estava **incompleto ou vazio**.

### ‚úÖ Solu√ß√£o alternativa:

> Para n√£o atrasar o cronograma, adotou-se um dataset do Kinect (TUM RGB-D `freiburg1_xyz`) como substituto tempor√°rio.

---

## ‚úÖ **üîπ Dia 2 ‚Äî Convers√£o e Organiza√ß√£o dos Dados**

### üéØ Objetivo:

Extrair imagens RGB, mapas de profundidade e par√¢metros de c√¢mera do `.bag`, estruturando-os para o pipeline de reconstru√ß√£o.

### üîß Procedimentos esperados com `.bag` da D435:

* Usar `rosbags` para ler `.db3` e exportar:

  * RGB ‚Üí `.png`
  * Depth ‚Üí `.png` (16-bit)
  * Camera info ‚Üí `intrinsics.json`

### ‚ö†Ô∏è Problema enfrentado:

> O `.bag` do Kinect estava no formato **ROS 1 (n√£o ROS 2)** e n√£o era compat√≠vel com `ros2 bag`.

### ‚úÖ Solu√ß√£o alternativa:

> Como o dataset TUM j√° fornece arquivos separados, a extra√ß√£o foi desnecess√°ria. O dataset foi estruturado como:

```
datasets/lab_scene_kinect/
‚îú‚îÄ‚îÄ rgb/
‚îú‚îÄ‚îÄ depth/
‚îú‚îÄ‚îÄ rgb.txt
‚îú‚îÄ‚îÄ depth.txt
‚îú‚îÄ‚îÄ groundtruth.txt
‚îî‚îÄ‚îÄ intrinsics.json   ‚úÖ criado manualmente
```

### üìÑ `intrinsics.json` (valores padr√£o para Kinect da TUM):

```json
{
  "width": 640,
  "height": 480,
  "K": [517.3, 0.0, 318.6,
        0.0, 516.5, 255.3,
        0.0, 0.0, 1.0],
  "D": [0, 0, 0, 0, 0],
  "distortion_model": "plumb_bob"
}
```

---

## ‚úÖ **üîπ Dia 3 ‚Äî Reconstru√ß√£o com Profundidade Real**

### üéØ Objetivo:

Aplicar o pipeline de **multiway registration** da Open3D utilizando as profundidades reais do Kinect (substituindo temporariamente a D435).

### üß† Etapas implementadas:

1. Carregamento de RGB + profundidade.
2. Cria√ß√£o da nuvem de pontos por quadro com intr√≠nsecos corretos.
3. Downsample + c√°lculo de normais + FPFH (impl√≠cito).
4. Registro par-a-par (ICP).
5. Otimiza√ß√£o global do grafo de poses.
6. Mesclagem das nuvens transformadas.
7. Salvamento como `reconstruction_d435.ply`.

### üêç Script utilizado:

> `multiway_registration_real_depth.py`

üìÅ Salva a reconstru√ß√£o em:

```bash
datasets/lab_scene_kinect/reconstruction_d435.ply
```

üìà Tamb√©m imprime:

* N√∫mero total de pontos.
* Volume da caixa delimitadora (AABB).

---

## ‚úÖ Visualiza√ß√£o da reconstru√ß√£o

### üß≠ Escolha do modo:

* `--mode open3d`: janela interativa local.
* `--mode rviz`: publica√ß√£o como `/reconstruction_points` (ROS 2).

### üêç Script utilizado:

> `reconstruction_viewer.py`

üîß Depend√™ncia ROS 2: `rclpy`, `sensor_msgs`, `std_msgs`.

### Exemplo de execu√ß√£o:

```bash
python reconstruction_viewer.py --mode open3d
python reconstruction_viewer.py --mode rviz
```

---

## ‚úÖ Conclus√£o (Parcial)

Mesmo com a falha de aquisi√ß√£o inicial com a RealSense D435, foi poss√≠vel:

* Simular todo o pipeline com um dataset RGB-D compat√≠vel.
* Validar o processo de reconstru√ß√£o com profundidade real.
* Obter reconstru√ß√£o global funcional.

---

## üìù Observa√ß√µes Finais:

* Quando for poss√≠vel repetir a aquisi√ß√£o com a D435, basta:

  * Substituir os diret√≥rios `rgb/`, `depth/`, e `intrinsics.json`.
  * Reexecutar o script `multiway_registration_real_depth.py`.

---